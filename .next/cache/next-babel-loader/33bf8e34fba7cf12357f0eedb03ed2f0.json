{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/zuares/Documents/Project/ZCommerce/pages/cart.js\",\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport React, { useContext, useState, useEffect } from 'react';\nimport MainApp from '../components/layouts/MainApp';\nimport Content from '../components/container/Content';\nimport CartTable from '../components/molecules/Table/CartTable';\nimport Notify from '../components/molecules/Notify';\nimport Fields from '../components/molecules/Fields';\nimport { DataContext } from '../store/GlobalState';\nimport PayButton from '../components/molecules/Button/PayButton';\nimport Link from 'next/link';\nimport { getData, postData } from '../utils/fetchData';\nimport { useRouter } from 'next/router';\n\nfunction cart() {\n  _s();\n\n  var _this = this;\n\n  var _useContext = useContext(DataContext),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch;\n\n  var cart = state.cart,\n      notify = state.notify,\n      auth = state.auth;\n\n  var _useState = useState(''),\n      address = _useState[0],\n      setAddress = _useState[1];\n\n  var _useState2 = useState(''),\n      mobile = _useState2[0],\n      setMobile = _useState2[1];\n\n  var _useState3 = useState(0),\n      total = _useState3[0],\n      setTotal = _useState3[1];\n\n  var router = useRouter();\n\n  var _useState4 = useState(false),\n      callback = _useState4[0],\n      setCallback = _useState4[1];\n\n  var handlePayment = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var newCart, _iterator, _step, item, res;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!address || !mobile)) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: \"NOTIFY\",\n                payload: {\n                  msg: {\n                    err: \"Please Add your address and mobile\"\n                  }\n                }\n              }));\n\n            case 2:\n              newCart = [];\n              _iterator = _createForOfIteratorHelper(cart);\n              _context.prev = 4;\n\n              _iterator.s();\n\n            case 6:\n              if ((_step = _iterator.n()).done) {\n                _context.next = 15;\n                break;\n              }\n\n              item = _step.value;\n              _context.next = 10;\n              return getData(\"product/\".concat(item._id));\n\n            case 10:\n              res = _context.sent;\n              console.log(res);\n\n              if (res.inStock - item.quantity >= 0) {\n                newCart.push(item);\n              }\n\n            case 13:\n              _context.next = 6;\n              break;\n\n            case 15:\n              _context.next = 20;\n              break;\n\n            case 17:\n              _context.prev = 17;\n              _context.t0 = _context[\"catch\"](4);\n\n              _iterator.e(_context.t0);\n\n            case 20:\n              _context.prev = 20;\n\n              _iterator.f();\n\n              return _context.finish(20);\n\n            case 23:\n              if (!(newCart.length < cart.length)) {\n                _context.next = 26;\n                break;\n              }\n\n              setCallback(!callback);\n              return _context.abrupt(\"return\", dispatch({\n                type: \"NOTIFY\",\n                payload: {\n                  msg: {\n                    err: \"The product is out of stock or quantity insuffienct\"\n                  }\n                }\n              }));\n\n            case 26:\n              postData('order', {\n                address: address,\n                mobile: mobile,\n                cart: cart,\n                total: total\n              }, auth.access_token).then(function (res) {\n                if (res.err) return dispatch({\n                  type: \"NOTIFY\",\n                  payload: {\n                    msg: {\n                      err: res.err\n                    }\n                  }\n                });\n                dispatch({\n                  type: \"CART\",\n                  payload: []\n                });\n\n                var newOrder = _objectSpread(_objectSpread({}, res.newOrder), {}, {\n                  user: auth.user\n                });\n\n                dispatch({\n                  type: \"ORDER\",\n                  payload: [].concat(_toConsumableArray(order), [newOrder])\n                });\n                dispatch({\n                  type: \"NOTIFY\",\n                  payload: {\n                    msg: {\n                      success: res.msg\n                    }\n                  }\n                });\n                return Router.push(\"/order/\".concat(res.newOrder._id));\n              });\n\n            case 27:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 17, 20, 23]]);\n    }));\n\n    return function handlePayment() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var getTotal = function getTotal() {\n      var res = cart.reduce(function (prev, item) {\n        return prev + item.price * item.quantity;\n      }, 0);\n      setTotal(res);\n    };\n\n    getTotal();\n  }, [cart]);\n  useEffect(function () {\n    var cartLocal = JSON.parse(localStorage.getItem('MyCart'));\n\n    if (cartLocal.length > 0) {\n      var updateCart = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n          var newArr, _iterator2, _step2, item, res, _id, title, images, price, inStock, sold;\n\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  newArr = [];\n                  _iterator2 = _createForOfIteratorHelper(cartLocal);\n                  _context2.prev = 2;\n\n                  _iterator2.s();\n\n                case 4:\n                  if ((_step2 = _iterator2.n()).done) {\n                    _context2.next = 14;\n                    break;\n                  }\n\n                  item = _step2.value;\n                  _context2.next = 8;\n                  return getData(\"product/\".concat(item._id));\n\n                case 8:\n                  res = _context2.sent;\n                  _id = res._id, title = res.title, images = res.images, price = res.price, inStock = res.inStock, sold = res.sold;\n\n                  if (inStock > 0) {\n                    newArr.push({\n                      _id: _id,\n                      title: title,\n                      images: images,\n                      price: price,\n                      inStock: inStock,\n                      sold: sold,\n                      quantity: item.quantity > inStock - sold ? 1 : item.quantity\n                    });\n                  }\n\n                  dispatch({\n                    type: \"CART\",\n                    payload: newArr\n                  });\n\n                case 12:\n                  _context2.next = 4;\n                  break;\n\n                case 14:\n                  _context2.next = 19;\n                  break;\n\n                case 16:\n                  _context2.prev = 16;\n                  _context2.t0 = _context2[\"catch\"](2);\n\n                  _iterator2.e(_context2.t0);\n\n                case 19:\n                  _context2.prev = 19;\n\n                  _iterator2.f();\n\n                  return _context2.finish(19);\n\n                case 22:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, null, [[2, 16, 19, 22]]);\n        }));\n\n        return function updateCart() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      updateCart();\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(MainApp, {\n    children: [notify.msg ? /*#__PURE__*/_jsxDEV(Notify, {\n      msg: notify.msg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 27\n    }, this) : null, /*#__PURE__*/_jsxDEV(Content, {\n      title: \"My Cart\",\n      children: cart.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lg:flex justify-between \",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lg:w-7/12\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-true-gray-400 font-bold mb-8 inline-block border-b pb-2 \",\n            children: \"Your Items\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 102,\n            columnNumber: 33\n          }, this), cart.map(function (item, idx) {\n            return /*#__PURE__*/_jsxDEV(CartTable, {\n              id: idx,\n              item: item\n            }, idx, false, {\n              fileName: _jsxFileName,\n              lineNumber: 104,\n              columnNumber: 61\n            }, _this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-bold text-lg \",\n          children: [\"Total : \", total]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-4 mt-8 lg:mt-0 md:w-8/12 lg:w-4/12 px-2 \",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-true-gray-400 font-bold border-b pb-2 inline-block\",\n            children: \"Payment\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-4 shadow-lg px-4 py-8 \",\n            children: [/*#__PURE__*/_jsxDEV(Fields, {\n              type: \"text\",\n              name: \"address\",\n              label: \"Adress\",\n              value: address,\n              onChange: function onChange(e) {\n                return setAddress(e.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Fields, {\n              type: \"text\",\n              name: \"mobile\",\n              label: \"Mobile\",\n              value: mobile,\n              onChange: function onChange(e) {\n                return setMobile(e.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 115,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Link, {\n              href: auth.user ? '#!' : '/login',\n              children: /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"px-5 py-2.5 bg-yellow-300 text-white font-bold shadow-md inline-block \",\n                onClick: handlePayment,\n                children: \"Process\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 117,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 25\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-center items-center \",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"cart.png\",\n            alt: \"\",\n            className: \" w-56 object-cover mt-20 \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center mt-8\",\n            children: /*#__PURE__*/_jsxDEV(\"h2\", {\n              className: \"text-xl font-bold text-true-gray-500\",\n              children: \"Keranjang kosong\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 130,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 129,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 25\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 94,\n    columnNumber: 9\n  }, this);\n}\n\n_s(cart, \"fhRSeVBje+NZ1XTpD0ZybsGE1cg=\", false, function () {\n  return [useRouter];\n});\n\nexport default cart;","map":{"version":3,"sources":["/home/zuares/Documents/Project/ZCommerce/pages/cart.js"],"names":["React","useContext","useState","useEffect","MainApp","Content","CartTable","Notify","Fields","DataContext","PayButton","Link","getData","postData","useRouter","cart","state","dispatch","notify","auth","address","setAddress","mobile","setMobile","total","setTotal","router","callback","setCallback","handlePayment","type","payload","msg","err","newCart","item","_id","res","console","log","inStock","quantity","push","length","access_token","then","newOrder","user","order","success","Router","getTotal","reduce","prev","price","cartLocal","JSON","parse","localStorage","getItem","updateCart","newArr","title","images","sold","map","idx","e","target","value"],"mappings":"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","sourcesContent":["import React, { useContext, useState, useEffect } from 'react';\nimport MainApp from '../components/layouts/MainApp'\nimport Content from '../components/container/Content'\nimport CartTable from '../components/molecules/Table/CartTable';\nimport Notify from '../components/molecules/Notify';\nimport Fields from '../components/molecules/Fields';\nimport { DataContext } from '../store/GlobalState';\nimport PayButton from '../components/molecules/Button/PayButton';\nimport Link from 'next/link';\nimport { getData, postData } from '../utils/fetchData';\nimport { useRouter } from 'next/router'\n\nfunction cart() {\n    const { state, dispatch } = useContext(DataContext)\n    const { cart, notify, auth } = state\n    const [address, setAddress] = useState('')\n    const [mobile, setMobile] = useState('')\n    const [total, setTotal] = useState(0)\n\n    const router = useRouter()\n\n    const [callback, setCallback] = useState(false)\n\n    const handlePayment = async () => {\n        if (!address || !mobile)\n            return dispatch({ type: \"NOTIFY\", payload: { msg: { err: `Please Add your address and mobile` } } })\n\n        let newCart = [];\n        for (const item of cart) {\n            const res = await getData(`product/${item._id}`)\n            console.log(res);\n            if (res.inStock - item.quantity >= 0) {\n                newCart.push(item)\n            }\n        }\n\n        if (newCart.length < cart.length) {\n            setCallback(!callback)\n            return dispatch({ type: \"NOTIFY\", payload: { msg: { err: `The product is out of stock or quantity insuffienct` } } })\n        }\n\n        postData('order', { address, mobile, cart, total }, auth.access_token)\n            .then(res => {\n                if (res.err) return dispatch({ type: \"NOTIFY\", payload: { msg: { err: res.err } } })\n\n                dispatch({ type: \"CART\", payload: [] })\n                const newOrder = {\n                    ...res.newOrder,\n                    user: auth.user\n                }\n                dispatch({ type: \"ORDER\", payload: [...order, newOrder] })\n                dispatch({ type: \"NOTIFY\", payload: { msg: { success: res.msg } } })\n\n                return Router.push(`/order/${res.newOrder._id}`)\n            })\n\n\n    }\n\n    useEffect(() => {\n        const getTotal = () => {\n            const res = cart.reduce((prev, item) => {\n                return prev + (item.price * item.quantity)\n            }, 0)\n            setTotal(res)\n        }\n        getTotal()\n    }, [cart]);\n\n    useEffect(() => {\n        const cartLocal = JSON.parse(localStorage.getItem('MyCart'))\n        if (cartLocal.length > 0) {\n            const updateCart = async () => {\n                let newArr = []\n                for (const item of cartLocal) {\n                    const res = await getData(`product/${item._id}`)\n                    const { _id, title, images, price, inStock, sold } = res\n                    if (inStock > 0) {\n                        newArr.push(\n                            {\n                                _id, title, images, price, inStock, sold,\n                                quantity: item.quantity > inStock - sold ? 1 : item.quantity\n                            }\n                        )\n                    }\n                    dispatch({ type: \"CART\", payload: newArr })\n                }\n            }\n            updateCart()\n        }\n    }, []);\n\n    return (\n        <MainApp>\n            {notify.msg ? <Notify msg={notify.msg} /> : null}\n            <Content title=\"My Cart\" >\n                {\n                    cart.length > 0 ?\n                        <div className={`lg:flex justify-between `}>\n\n                            <div className={`lg:w-7/12`} >\n                                <h2 className={`text-true-gray-400 font-bold mb-8 inline-block border-b pb-2 `} >Your Items</h2>\n                                {\n                                    cart.map((item, idx) => <CartTable key={idx} id={idx} item={item} />)\n                                }\n\n                            </div>\n                            <div className={`font-bold text-lg `} >\n                                Total : {total}\n                            </div>\n                            <div className={`space-y-4 mt-8 lg:mt-0 md:w-8/12 lg:w-4/12 px-2 `}>\n                                <h2 className={`text-true-gray-400 font-bold border-b pb-2 inline-block`} >Payment</h2>\n                                <div className={`space-y-4 shadow-lg px-4 py-8 `} >\n                                    <Fields type=\"text\" name=\"address\" label=\"Adress\" value={address} onChange={(e) => setAddress(e.target.value)} />\n                                    <Fields type=\"text\" name=\"mobile\" label=\"Mobile\" value={mobile} onChange={(e) => setMobile(e.target.value)} />\n                                    <Link href={auth.user ? '#!' : '/login'}  >\n                                        <a className={`px-5 py-2.5 bg-yellow-300 text-white font-bold shadow-md inline-block `} onClick={handlePayment}  >\n                                            Process\n                                   </a>\n                                    </Link>\n                                </div>\n                            </div>\n\n                        </div>\n                        :\n                        <div className={`flex justify-center items-center `} >\n                            <div>\n                                <img src={`cart.png`} alt=\"\" className={` w-56 object-cover mt-20 `} />\n                                <div className={`text-center mt-8`} >\n                                    <h2 className={`text-xl font-bold text-true-gray-500`} >Keranjang kosong</h2>\n                                </div>\n                            </div>\n                        </div>\n                }\n            </Content>\n        </MainApp>\n    );\n}\n\nexport default cart;"]},"metadata":{},"sourceType":"module"}