{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar _jsxFileName = \"/home/zuares/Documents/Project/ZCommerce/pages/cart.js\",\n    _s = $RefreshSig$();\n\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === \"undefined\" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport React, { useContext, useState, useEffect } from 'react';\nimport MainApp from '../components/layouts/MainApp';\nimport Content from '../components/container/Content';\nimport CartTable from '../components/molecules/Table/CartTable';\nimport Notify from '../components/molecules/Notify';\nimport Fields from '../components/molecules/Fields';\nimport { DataContext } from '../store/GlobalState';\nimport PayButton from '../components/molecules/Button/PayButton';\nimport Link from 'next/link';\nimport { getData } from '../utils/fetchData';\n\nfunction cart() {\n  _s();\n\n  var _this = this;\n\n  var _useContext = useContext(DataContext),\n      state = _useContext.state,\n      dispatch = _useContext.dispatch;\n\n  var cart = state.cart,\n      notify = state.notify,\n      auth = state.auth;\n\n  var _useState = useState(''),\n      address = _useState[0],\n      setAddress = _useState[1];\n\n  var _useState2 = useState(''),\n      mobile = _useState2[0],\n      setMobile = _useState2[1];\n\n  var _useState3 = useState(0),\n      total = _useState3[0],\n      setTotal = _useState3[1];\n\n  var _useState4 = useState(false),\n      callback = _useState4[0],\n      setCallback = _useState4[1];\n\n  var handlePayment = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var newCart, _iterator, _step, item, res;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(!address || !mobile)) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\", dispatch({\n                type: \"NOTIFY\",\n                payload: {\n                  msg: {\n                    err: \"Please Add your address and mobile\"\n                  }\n                }\n              }));\n\n            case 2:\n              newCart = [];\n              _iterator = _createForOfIteratorHelper(cart);\n              _context.prev = 4;\n\n              _iterator.s();\n\n            case 6:\n              if ((_step = _iterator.n()).done) {\n                _context.next = 14;\n                break;\n              }\n\n              item = _step.value;\n              _context.next = 10;\n              return getData(\"product/\".concat(item._id));\n\n            case 10:\n              res = _context.sent;\n\n              if (res.product.inStock - item.quantity >= 0) {\n                newCart.push(item);\n              }\n\n            case 12:\n              _context.next = 6;\n              break;\n\n            case 14:\n              _context.next = 19;\n              break;\n\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](4);\n\n              _iterator.e(_context.t0);\n\n            case 19:\n              _context.prev = 19;\n\n              _iterator.f();\n\n              return _context.finish(19);\n\n            case 22:\n              if (!(newCart.length < cart.length)) {\n                _context.next = 25;\n                break;\n              }\n\n              setCallback(!callback);\n              return _context.abrupt(\"return\", dispatch({\n                type: \"NOTIFY\",\n                payload: {\n                  msg: {\n                    err: \"The product is out of stock or quantity insuffienct\"\n                  }\n                }\n              }));\n\n            case 25:\n              dispatch({\n                type: \"NOTIFY\",\n                payload: {\n                  msg: {\n                    err: \"The product is out of stock or quantity insuffienct\"\n                  }\n                }\n              });\n\n            case 26:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[4, 16, 19, 22]]);\n    }));\n\n    return function handlePayment() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    var getTotal = function getTotal() {\n      var res = cart.reduce(function (prev, item) {\n        return prev + item.price * item.quantity;\n      }, 0);\n      setTotal(res);\n    };\n\n    getTotal();\n  }, [cart]);\n  useEffect(function () {\n    var cartLocal = JSON.parse(localStorage.getItem('MyCart'));\n\n    if (cartLocal.length == 0) {\n      var newArr = [];\n\n      var updateCart = /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n          var _iterator2, _step2, item, res, _res$product, _id, title, images, price, inStock, sold;\n\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  _iterator2 = _createForOfIteratorHelper(cartLocal);\n                  _context2.prev = 1;\n\n                  _iterator2.s();\n\n                case 3:\n                  if ((_step2 = _iterator2.n()).done) {\n                    _context2.next = 14;\n                    break;\n                  }\n\n                  item = _step2.value;\n                  _context2.next = 7;\n                  return getData(\"product/\".concat(item._id));\n\n                case 7:\n                  res = _context2.sent;\n                  console.log(res);\n                  _res$product = res.product, _id = _res$product._id, title = _res$product.title, images = _res$product.images, price = _res$product.price, inStock = _res$product.inStock, sold = _res$product.sold;\n\n                  if (inStock > 0) {\n                    newArr.push({\n                      _id: _id,\n                      title: title,\n                      images: images,\n                      price: price,\n                      inStock: inStock,\n                      sold: sold,\n                      quantity: item.quantity > inStock - sold ? 1 : item.quantity\n                    });\n                  }\n\n                  dispatch({\n                    type: \"CART\",\n                    payload: newArr\n                  });\n\n                case 12:\n                  _context2.next = 3;\n                  break;\n\n                case 14:\n                  _context2.next = 19;\n                  break;\n\n                case 16:\n                  _context2.prev = 16;\n                  _context2.t0 = _context2[\"catch\"](1);\n\n                  _iterator2.e(_context2.t0);\n\n                case 19:\n                  _context2.prev = 19;\n\n                  _iterator2.f();\n\n                  return _context2.finish(19);\n\n                case 22:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2, null, [[1, 16, 19, 22]]);\n        }));\n\n        return function updateCart() {\n          return _ref2.apply(this, arguments);\n        };\n      }();\n\n      updateCart();\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(MainApp, {\n    children: [notify.msg ? /*#__PURE__*/_jsxDEV(Notify, {\n      msg: notify.msg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 27\n    }, this) : null, /*#__PURE__*/_jsxDEV(Content, {\n      title: \"My Cart\",\n      children: cart.length > 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"lg:flex justify-between \",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"lg:w-7/12\",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-true-gray-400 font-bold mb-8 inline-block border-b pb-2 \",\n            children: \"Your Items\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 33\n          }, this), cart.map(function (item, idx) {\n            return /*#__PURE__*/_jsxDEV(CartTable, {\n              id: idx,\n              item: item\n            }, idx, false, {\n              fileName: _jsxFileName,\n              lineNumber: 88,\n              columnNumber: 61\n            }, _this);\n          })]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"font-bold text-lg \",\n          children: [\"Total : \", total]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"space-y-4 mt-8 lg:mt-0 md:w-8/12 lg:w-4/12 px-2 \",\n          children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n            className: \"text-true-gray-400 font-bold border-b pb-2 inline-block\",\n            children: \"Payment\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 96,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"space-y-4 shadow-lg px-4 py-8 \",\n            children: [/*#__PURE__*/_jsxDEV(Fields, {\n              type: \"text\",\n              name: \"address\",\n              label: \"Adress\",\n              value: address,\n              onChange: function onChange(e) {\n                return setAddress(e.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 98,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Fields, {\n              type: \"text\",\n              name: \"mobile\",\n              label: \"Mobile\",\n              value: mobile,\n              onChange: function onChange(e) {\n                return setMobile(e.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 99,\n              columnNumber: 37\n            }, this), /*#__PURE__*/_jsxDEV(Link, {\n              href: auth.user ? '#!' : '/login',\n              children: /*#__PURE__*/_jsxDEV(\"a\", {\n                className: \"px-5 py-2.5 bg-yellow-300 text-white font-bold shadow-md inline-block \",\n                onClick: handlePayment,\n                children: \"Process\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 101,\n                columnNumber: 41\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 100,\n              columnNumber: 37\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 97,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 95,\n          columnNumber: 29\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 25\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex justify-center items-center \",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"cart.png\",\n            alt: \"\",\n            className: \" w-56 object-cover mt-20 \"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 112,\n            columnNumber: 33\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"text-center mt-8\",\n            children: /*#__PURE__*/_jsxDEV(\"h2\", {\n              className: \"text-xl font-bold text-true-gray-500\",\n              children: \"Keranjang kosong\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 114,\n              columnNumber: 37\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 113,\n            columnNumber: 33\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 29\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 25\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 9\n  }, this);\n}\n\n_s(cart, \"6ykAEIssAyST+ruKkIT9WjmSryw=\");\n\nexport default cart;","map":{"version":3,"sources":["/home/zuares/Documents/Project/ZCommerce/pages/cart.js"],"names":["React","useContext","useState","useEffect","MainApp","Content","CartTable","Notify","Fields","DataContext","PayButton","Link","getData","cart","state","dispatch","notify","auth","address","setAddress","mobile","setMobile","total","setTotal","callback","setCallback","handlePayment","type","payload","msg","err","newCart","item","_id","res","product","inStock","quantity","push","length","getTotal","reduce","prev","price","cartLocal","JSON","parse","localStorage","getItem","newArr","updateCart","console","log","title","images","sold","map","idx","e","target","value","user"],"mappings":"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","sourcesContent":["import React, { useContext, useState, useEffect } from 'react';\nimport MainApp from '../components/layouts/MainApp'\nimport Content from '../components/container/Content'\nimport CartTable from '../components/molecules/Table/CartTable';\nimport Notify from '../components/molecules/Notify';\nimport Fields from '../components/molecules/Fields';\nimport { DataContext } from '../store/GlobalState';\nimport PayButton from '../components/molecules/Button/PayButton';\nimport Link from 'next/link';\nimport { getData } from '../utils/fetchData';\n\nfunction cart() {\n    const { state, dispatch } = useContext(DataContext)\n    const { cart, notify, auth } = state\n    const [address, setAddress] = useState('')\n    const [mobile, setMobile] = useState('')\n    const [total, setTotal] = useState(0)\n\n    const [callback, setCallback] = useState(false)\n\n    const handlePayment = async () => {\n        if (!address || !mobile)\n            return dispatch({ type: \"NOTIFY\", payload: { msg: { err: `Please Add your address and mobile` } } })\n\n        let newCart = [];\n        for (const item of cart) {\n            const res = await getData(`product/${item._id}`)\n            if (res.product.inStock - item.quantity >= 0) {\n                newCart.push(item)\n            }\n        }\n\n        if (newCart.length < cart.length) {\n            setCallback(!callback)\n            return dispatch({ type: \"NOTIFY\", payload: { msg: { err: `The product is out of stock or quantity insuffienct` } } })\n        }\n\n        dispatch({ type: \"NOTIFY\", payload: { msg: { err: `The product is out of stock or quantity insuffienct` } } })\n\n    }\n\n    useEffect(() => {\n        const getTotal = () => {\n            const res = cart.reduce((prev, item) => {\n                return prev + (item.price * item.quantity)\n            }, 0)\n            setTotal(res)\n        }\n        getTotal()\n    }, [cart]);\n\n    useEffect(() => {\n        const cartLocal = JSON.parse(localStorage.getItem('MyCart'))\n        if (cartLocal.length == 0) {\n            let newArr = []\n            const updateCart = async () => {\n                for (const item of cartLocal) {\n                    const res = await getData(`product/${item._id}`)\n                    console.log(res);\n                    const { _id, title, images, price, inStock, sold } = res.product\n                    if (inStock > 0) {\n                        newArr.push(\n                            {\n                                _id, title, images, price, inStock, sold,\n                                quantity: item.quantity > inStock - sold ? 1 : item.quantity\n                            }\n                        )\n                    }\n                    dispatch({ type: \"CART\", payload: newArr })\n\n                }\n            }\n            updateCart()\n        }\n    }, []);\n\n    return (\n        <MainApp>\n            {notify.msg ? <Notify msg={notify.msg} /> : null}\n            <Content title=\"My Cart\" >\n                {\n                    cart.length > 0 ?\n                        <div className={`lg:flex justify-between `}>\n\n                            <div className={`lg:w-7/12`} >\n                                <h2 className={`text-true-gray-400 font-bold mb-8 inline-block border-b pb-2 `} >Your Items</h2>\n                                {\n                                    cart.map((item, idx) => <CartTable key={idx} id={idx} item={item} />)\n                                }\n\n                            </div>\n                            <div className={`font-bold text-lg `} >\n                                Total : {total}\n                            </div>\n                            <div className={`space-y-4 mt-8 lg:mt-0 md:w-8/12 lg:w-4/12 px-2 `}>\n                                <h2 className={`text-true-gray-400 font-bold border-b pb-2 inline-block`} >Payment</h2>\n                                <div className={`space-y-4 shadow-lg px-4 py-8 `} >\n                                    <Fields type=\"text\" name=\"address\" label=\"Adress\" value={address} onChange={(e) => setAddress(e.target.value)} />\n                                    <Fields type=\"text\" name=\"mobile\" label=\"Mobile\" value={mobile} onChange={(e) => setMobile(e.target.value)} />\n                                    <Link href={auth.user ? '#!' : '/login'}  >\n                                        <a className={`px-5 py-2.5 bg-yellow-300 text-white font-bold shadow-md inline-block `} onClick={handlePayment}  >\n                                            Process\n                                   </a>\n                                    </Link>\n                                </div>\n                            </div>\n\n                        </div>\n                        :\n                        <div className={`flex justify-center items-center `} >\n                            <div>\n                                <img src={`cart.png`} alt=\"\" className={` w-56 object-cover mt-20 `} />\n                                <div className={`text-center mt-8`} >\n                                    <h2 className={`text-xl font-bold text-true-gray-500`} >Keranjang kosong</h2>\n                                </div>\n                            </div>\n                        </div>\n                }\n            </Content>\n        </MainApp>\n    );\n}\n\nexport default cart;"]},"metadata":{},"sourceType":"module"}